---
title: "Project 1: HO2 Analysis"
author: "Alex Hyman"
date: "7/13/2018"
output: pdf_document
---
#Assignment:
1. Use headers (##), r-chunks for code, and text to build a report that addresses the two parts of this project.

2. List in the text the ‘R’ skills needed to complete this project.

3. Explain each of the functions (e.g., ggplot()) used to compute and visualize results.

4. Discuss how well did the results begin to answer the business questions posed at the beginning of each part of the project.

# Part 1: HO2 data preparation and exploration

 Data is provided by the turing.manhattan.edu website and is accessed via the url function. The following R block will read the data, ensuring that the DATE column is not read as a factor. We will also preview the data with the head function and clean the data with the na.omit function. The na.omit function will get rid of any rows that have NA as a value. Finally, the structure of the data frame is viewed to ensure the data is set up as we wish.
 
 
```{r}
# getting the data from online at https://turing.manhattan.edu/~wfoote01/finalytics/data/
# reading the nyhh02.csv file
HO2 <- read.csv(url("https://turing.manhattan.edu/~wfoote01/finalytics/data/nyhh02.csv"), stringsAsFactors = F, header = T)
# Previewing the data
head(HO2)
# Omitting the na values in the data frame
HO2 <- na.omit(HO2)
# looking at the structure of the data frames
str(HO2) # Two columns, DATE is a character, DHOILNYH is a numeric column
```



## Question 1 - Nature of HO2 Returns
The following block of R code will take the time series pricing data we collected previously and convert it into a data frame with columns including the date, percent returns, magnitude of returns, direction, and the price. The data frame will have three numeric columns (price, returns, size), one factor column (direction), and one date column (Date).


```{r}
# Calculating difference of logs returns to calculate approximate percent change
return <- as.numeric(diff(log(HO2$DHOILNYH))) * 100
# Getting the absolute value of the percent changes to get magnitude
size <- as.numeric(abs(return))
# creating a character vector that will hold information on whether the price went up, down, or stayed the same using logical indexing on the returns
direction <- character(length(return))
direction[return > 0] <- "up"
direction[return < 0] <- "down"
direction[return == 0] <- "same"
# Converting the dates in HO2 to actual dates using the as.Date function. Deleting the first index of dates because there is no percent change on the first entry
date <- as.Date(HO2$DATE[-1], "%m/%d/%Y")
# Creating a vector of the prices. Deleting the first index so we can have same lengths in vectors.
price <- HO2$DHOILNYH[-1]
# Creating a data frame for HO2 that contains the returns percent change, date, direction, magnitude of returns and the actual price
HO2.df <- na.omit(data.frame(
                            Date = date, 
                            Price = price,
                            Return = return,
                            Size = size,
                            Direction = direction
                             ))
# Looking at the structure of the data frame. The Dates should be included as dates and the direction should be a factor with three different levels: "up", "down", "same"
str(HO2.df)
```

Firstly, we will plot the returns of HO2 overtime via the ggplot2 library and the ggplot function. The aesthetic inside the ggplot will have x set to the date and y set to the return. The geom_line will also be added to the ggplot and have the line color set to blue.


```{r}
library(ggplot2)
p <- ggplot(HO2.df, aes(x = Date, y = Return, group = 1)) + geom_line(colour = 'blue')
p
```

Next, we will create a bar plot of the absolute value of the percent returns. This will be done using the ggplot function with the Date as the X-axis and the absolute value of the percent returns as the y-axis. The plot is displyed as a bar chart, adding the geom_bar tool to the ggplot. Because we are not interested in count data, the stat argument within the geom_bar tool is set to identity to show the actual size over time.


```{r}
# Using the bar chart tool from the ggplot function
p <- ggplot(HO2.df, aes(x = Date, y = Size, group = 1)) + 
    geom_bar(stat = "identity", colour = "green") # Setting stat to identity so we do not show count data
p # Displaying the plot
```

Next, we will provide a plot that contains both the absolute value of the returns in an orange color and the actual returns in blue. Wherever the orange line is visible, the returns were negative for that day. 


```{r}
# Plotting the orange size of returns geom_bar plot first and then overlaying the blue geom_line plot to so only days that had negative returns will be visible in the plot. This is because the blue line would be below the x-axis and the absolute value is always positive
p <- ggplot(HO2.df, aes(x = Date, y = Size)) +
    geom_bar(stat = 'identity', colour = 'darkorange') +
    geom_line(data = HO2.df, aes(x = Date, y = Return), colour = 'blue')
p
```



## Question 2 - Analysis of HO2 
Next an analysis of the returns will be conducted. This analysis will include the:
    * Mean
    * Standard Deviation
    * Median
    * Skewness
    * Kurtosis


```{r}
# Creating a function to calculate all the analysis data listed above
data_moments <- function(data) {
    # Need the moments library for skewness and kurtosis
    library(moments)
    #Calculate mean
    mean.r <- mean(data)
    # Calculate standard deviation
    sd.r <- sd(data)
    # Calculate median
    median.r <- median(data)
    # Calculate skewness (shifted lef or right)
    skewness.r <- skewness(data)
    # Calculte the kurtosis (peakedness)
    kurtosis.r <- kurtosis(data)
    # Creating a data frame with all the moments
    result <- data.frame(Mean = mean.r, 'Standard Deviation' = sd.r,
                         Median = median.r, Skewness = skewness.r,
                         Kurtosis = kurtosis.r
                         )
    # Returning the data frame
    return(result)
}
# Using the function we created on the returns 
answer <- data_moments(HO2.df$Return)
# Rounding our data frame to only four decimal points
answer <- round(answer, 4)
# Creating table for display
knitr::kable(answer)
```

# Part 2: HO2 analysis
(INSERT explanatory text here)
## Further questions as needed
(INSERT explanatory text here)
```{r}

```

